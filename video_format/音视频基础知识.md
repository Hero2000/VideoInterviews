## 音视频基础知识点
### H264编码流程
#### H264压缩技巧
H264压缩技术主要采用了以下几种方法对视频数据进行压缩：
> * 帧内预测压缩，解决的是空间数据冗余的问题
> * 帧间预测压缩，就是运动估计与补偿，解决是时域数据冗余的问题
> * 整数离散余弦变换（DCT），将空间上的相关性变为频域上无关的数据进行量化处理
> * CABAC压缩

经过压缩后的帧分为：I帧、P帧、B帧
> * I帧：关键帧，采用的帧内压缩技术
> * P帧：向前参考帧，在压缩时，只参考前面已经处理过的帧
> * B帧：双向参考帧，在压缩时，参考前面的帧，又参考后面的帧，采用帧间压缩技术

一个GOP：Group of pictures，一组图像序列，两个I帧之间是一个图像序列。

#### H264压缩过程
> * 原始数据送到H264编码器的缓冲区，编码器为每一帧图片划分宏块。
> * H264默认使用16 * 16 大小的区域作为一个宏块，划分好宏块，计算宏块的像素值，进而计算每一帧图片中所有宏块的像素值
> * 在宏块的基础上划分更小的子块，子块大小可以自选，但是要求比宏块更小
> * 进行帧分组，视频数据有时间上的数据冗余和空间上的数据冗余，时间上的数据冗余比较大。相邻帧的图片差异不会很大。这样我们就推出了I帧、B帧、P帧的概念
> * 运动估计与补偿
> * 帧内预测
> * 对残差数据做DCT
> * CABAC，属于无损压缩技术

### H264和H265
H265仍然采用混合编解码，编解码结构与H264基本一致。
主要提升在于：
> * 编码块划分结构：采用CU/PU/TU的递归结构
> * 并行工具：增加了Tile以及WPP等并行工具集以提高编码速度
> * 滤波器：在区块滤波之后增加了SAO滤波模块
> * H265优化了实现细节，对高清视频的处理更加精细

### SPS和PPS

### FLV格式介绍
Flv格式的视频由Flv Header和Flv Body组成，Flv Body由一个一个Tag组成，每个Tag都有一个preTagSize字段，标记着前面一个Tag的大小。
### TS格式介绍
### MP4格式介绍
### HLS格式介绍
### DASH格式介绍
### RTMP协议分析
#### RTMP协议介绍
RTMP协议是应用层协议，是要靠底层可靠的传输层（TCP），
协议（通常是TCP）来保证信息传输的可靠性的。在基于传输层协议的链接建立完成后，RTMP协议也要客户端和服务器通过“握手”来建立基于传输层链接之上的RTMP Connection链接。播放一个RTMP协议的流媒体需要经过以下几个步骤：握手，建立网络连接，建立网络流，播放。服务器和客户端之间只能建立一个网络连接，但是基于该连接可以创建很多网络流。
#### RTMP为什么还要建连
这儿埋下一个小疑问？为什么传输层已经建立了TCP连接，RTMP还需要再次建立一个连接，有这个必要吗？

RTMP协议传输时会对数据做自己的格式化，这种格式的消息我们称之为RTMP Message，而实际传输的时候为了更好地实现多路复用、分包和信息的公平性，发送端会把Message划分为带有Message ID的Chunk，每个Chunk可能是一个单独的Message，也可能是Message的一部分，在接受端会根据chunk中包含的data的长度，message id和message的长度把chunk还原成完整的Message，从而实现信息的收发。

因为它们需要商量一些事情，保证以后的传输能正常进行。主要就是两个事情，一个是版本号，如果客户端、服务器的版本号不一致，则不能工作。另一个就是时间戳，视频播放中，时间是很重要的，后面的数据流互通的时候，经常要带上时间戳的差值，因而一开始双方就要知道对方的时间戳。


#### RTMP建连流程
> * RTMP握手
> * 拉流
> * 播放

RTMP握手流程:
> * 客户端发送 C0、C1、 C2，服务器发送 S0、 S1、 S2。
> * 首先，客户端发送 C0 表示自己的版本号，不必等对方的回复，然后发送 C1 表示自己的时间戳。
> * 服务器只有在收到 C0 的时候，才能返回 S0，表明自己的版本号，如果版本不匹配，可以断开连接。
> * 服务器发送完 S0 后，也不用等什么，就直接发送自己的时间戳 S1。客户端收到 S1 的时候，发一个知道了对方时间戳的 ACK C2。同理服务器收到 C1 的时候，发一个知道了对方时间戳的 ACK S2。
> * 握手建立完成。

RTMP拉流流程:
> * 建立网络连接---> Connect
> * 创建网络流---> Create Stream
> * 播放---> Play